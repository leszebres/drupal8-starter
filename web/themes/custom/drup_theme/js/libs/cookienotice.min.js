!function(l){"use strict";l.CookieNotice=function(e,s){return l.extend(this.settings={},l.CookieNotice.defaults,s),this.elements={body:l("body"),container:e},this.elements.siteLinks=this.settings.siteLinks(this.elements.body),this.config=this.elements.container.attr("data-config"),this.cookieName="cookienotice",!!this.prepareOptions()&&this.load()},l.CookieNotice.defaults={siteLinks:function(e){return e.find('a[target!="_blank"]')},classes:{prefix:"cookienotice",notice:"notice notice--cookie",noticeOpen:"is-{prefix}-notice-open",modal:"modal modal--cookie",modalOpen:"is-{prefix}-modal-open",btnAgree:"{prefix}-agree",btnCustomize:"{prefix}-customize",active:"is-active"},reload:!0,summary:767,cookieDuration:390,afterEventsHandler:void 0,onChangeState:void 0},l.CookieNotice.services={},l.CookieNotice.prototype={prepareOptions:function(){return!!navigator.cookieEnabled&&(this.replacePrefixClass(),this.elements.container.length?void 0===this.config||""===this.config?(this.setLog('Attribute "data-config" not found in the container element.',"error"),!1):(this.config=JSON.parse(this.config),!0):(this.setLog("Container element not found.","error"),!1))},load:function(){return this.wrapNotice(),this.loadStates()||(this.setState("all","undefined"),this.notice("show")),this.wrapModal(),this.eventsHandler(),this},wrapNotice:function(){if(this.elements.noticeWrapper=l("<div>",{class:this.settings.classes.notice}),void 0!==this.config.notice.description&&""!==this.config.notice.description&&(this.elements.noticeDescription=l("<p>",{class:this.settings.classes.prefix+"-notice-description",html:this.config.notice.description}),this.elements.noticeDescription.appendTo(this.elements.noticeWrapper)),this.elements.noticeActionsWrapper=l("<div>",{class:this.settings.classes.prefix+"-notice-actions"}),void 0!==this.config.modal&&void 0!==this.config.notice.customize&&""!==this.config.notice.customize){var e=[],s=l("<button>",{class:this.settings.classes.btnCustomize,html:this.config.notice.customize}).appendTo(this.elements.noticeActionsWrapper),t=this.elements.body.find("."+this.settings.classes.btnCustomize);e.push(s.get(0)),t.length&&e.push(t.get(0)),this.elements.btnCustomize=l(e)}return void 0!==this.config.notice.agree&&""!==this.config.notice.agree&&(this.elements.btnAgree=l("<button>",{class:this.settings.classes.btnAgree,html:this.config.notice.agree}).appendTo(this.elements.noticeActionsWrapper)),this.elements.noticeActionsWrapper.appendTo(this.elements.noticeWrapper),this.elements.noticeWrapper.appendTo(this.elements.container),this},notice:function(e){this.elements.body[("hide"===e?"remove":"add")+"Class"](this.settings.classes.noticeOpen)},wrapModal:function(){var c=this;if(void 0!==c.config.modal){if(c.elements.modalWrapper=l("<div>",{class:c.settings.classes.modal}),c.elements.modalHeader=l("<div>",{class:c.settings.classes.prefix+"-modal-header"}),void 0!==c.config.modal.label&&""!==c.config.modal.label&&l("<p>",{class:c.settings.classes.prefix+"-modal-label",html:c.config.modal.label}).appendTo(c.elements.modalHeader),void 0!==c.config.modal.description&&""!==c.config.modal.description&&l("<p>",{class:c.settings.classes.prefix+"-modal-description",html:c.config.modal.description}).appendTo(c.elements.modalHeader),void 0!==c.config.modal.close&&""!==c.config.modal.close&&(c.elements.modalClose=l("<button>",{class:c.settings.classes.prefix+"-modal-close",html:c.config.modal.close}).appendTo(c.elements.modalHeader)),c.elements.modalHeader.appendTo(c.elements.modalWrapper),void 0!==c.config.services){var t={};l.each(this.config.services,function(e,s){"all"!==e&&(void 0===t[s.group]&&(t[s.group]=[]),t[s.group].push(e))}),c.elements.servicesWrapper=l("<div>",{class:c.settings.classes.prefix+"-services"}),void 0!==c.config.services.all&&(c.elements.serviceAllWrapper=l("<div>",{class:c.settings.classes.prefix+"-service "+c.settings.classes.prefix+"-service--all","data-service":"all"}),l("<p>",{class:c.settings.classes.prefix+"-service-all-label",html:c.config.services.all.label}).appendTo(c.elements.serviceAllWrapper),c.wrapServiceActions("all").appendTo(c.elements.serviceAllWrapper),c.elements.serviceAllWrapper.appendTo(c.elements.servicesWrapper));var i=l("<ul>");l.each(t,function(e,s){var t=l("<li>",{class:c.settings.classes.prefix+"-group "+c.settings.classes.prefix+"-group--"+e}).appendTo(i);if(void 0!==c.config.groups[e].label&&""!==c.config.groups[e].label&&l("<p>",{class:c.settings.classes.prefix+"-group--label",html:c.config.groups[e].label}).appendTo(t),void 0!==c.config.groups[e].description&&""!==c.config.groups[e].description&&l("<p>",{class:c.settings.classes.prefix+"-group--description",html:c.config.groups[e].description}).appendTo(t),s.length){var n=l("<ul>");l.each(s,function(e,s){var t,i=l("<li>",{class:c.settings.classes.prefix+"-service "+c.settings.classes.prefix+"-service--"+s,"data-service":s}),o={class:c.settings.classes.prefix+"-service-label",html:c.config.services[s].label};void 0!==c.config.services[s].url&&""!==c.config.services[s].url?(o.href=c.config.services[s].url,t=l("<a>",o)):t=l("<span>",o),t.appendTo(i),c.wrapServiceActions(s).appendTo(i),i.appendTo(n)}),n.appendTo(t)}}),i.appendTo(c.elements.servicesWrapper),c.elements.servicesWrapper.appendTo(c.elements.modalWrapper)}c.elements.modalWrapper.appendTo(c.elements.container),c.elements.modalOverlay=l("<div>",{class:c.settings.classes.prefix+"-modal-overlay"}).appendTo(c.elements.container)}return c},wrapServiceActions:function(n){var c=this,a=l("<div>",{class:this.settings.classes.prefix+"-service-actions"});return l.each(["agree","disagree"],function(e,t){if(void 0!==c.config.services.all[t]&&""!==c.config.services.all[t]){var s=c.getState(n),i="agree"===t&&!0===s||"disagree"===t&&!1===s?" "+c.settings.classes.active:"";if("all"===n){var o=0;l.each(l.CookieNotice.services,function(e,s){"agree"===t&&!0===s?o++:"disagree"===t&&!1===s&&o++}),o===Object.keys(l.CookieNotice.services).length&&(i=" "+c.settings.classes.active)}l("<button>",{class:c.settings.classes.prefix+"-service-action "+c.settings.classes.prefix+"-service-action--"+t+i,"data-action":t,html:c.config.services.all[t]}).appendTo(a)}}),a},modal:function(e){this.elements.body[("hide"===e?"remove":"add")+"Class"](this.settings.classes.modalOpen)},eventsHandler:function(){var o=this;if(!1!==o.settings.summary&&o.elements.noticeDescription.length&&void 0!==o.config.notice.summary&&""!==o.config.notice.summary&&l(window).width()<=o.settings.summary&&(o.elements.noticeDescription.html(o.config.notice.summary),o.elements.noticeDescription.on("click",function(e){l(e.target).is("a")||o.elements.noticeDescription.html()===o.config.notice.description||o.elements.noticeDescription.html(o.config.notice.description)})),void 0!==o.elements.btnAgree&&o.elements.btnAgree.length&&o.elements.btnAgree.one("click.cookienotice.btnAgree",function(){o.agree(),o.notice("hide"),o.settings.reload?o.reload():o.elements.serviceAction.length&&o.elements.serviceAction.each(function(e,s){"agree"===(s=l(s)).attr("data-action")&&s.addClass(o.settings.classes.active)})}),void 0!==o.elements.btnCustomize&&o.elements.btnCustomize.length&&o.elements.btnCustomize.on("click.cookienotice.btnCustomize",function(e){e.preventDefault(),o.modal("show"),o.getCookie(o.cookieName)||o.notice("hide")}),void 0!==o.config.modal){var e=function(e){("click"===e.type||"keydown"===e.type&&27===e.keyCode)&&(o.modal("hide"),o.getCookie(o.cookieName)||o.notice("show"),o.reload())};o.elements.modalClose.length&&o.elements.modalClose.on("click.cookienotice.modalClose",e),o.elements.modalOverlay.length&&o.elements.modalOverlay.on("click.cookienotice.modalOverlay",e),l(document).on("keydown.cookienotice.modalEscape",e),o.elements.serviceAction=o.elements.servicesWrapper.find("button."+o.settings.classes.prefix+"-service-action"),o.elements.serviceAction.on("click.cookienotice.serviceAction",function(e){var s=l(e.currentTarget),t=s.attr("data-action"),i=s.closest("."+o.settings.classes.prefix+"-service").attr("data-service");void 0!==t&&void 0!==i&&(s.siblings().removeClass(o.settings.classes.active),s.addClass(o.settings.classes.active),"all"===i?o.elements.serviceAction.filter('[data-action="'+t+'"]').each(function(e,s){(s=l(s)).siblings().removeClass(o.settings.classes.active),s.addClass(o.settings.classes.active)}):o.elements.serviceAllWrapper.find("button").removeClass(o.settings.classes.active),o.setState(i,"agree"===t))})}return o.elements.siteLinks.not(o.elements.container.find("a")).not("."+o.settings.classes.btnCustomize).one("click.cookienotice.siteLinks",function(){o.agree(),o.notice("hide")}),void 0!==o.settings.afterEventsHandler&&o.settings.afterEventsHandler.call({cookieNotice:o,elements:o.elements}),o},agree:function(e){return e=e||"all",this.setState(e,!0)},disagree:function(e){return e=e||"all",this.setState(e,!1)},setState:function(e,t){return"all"===e&&void 0!==this.config.services?l.each(this.config.services,function(e,s){"all"!==e&&(l.CookieNotice.services[e]=t)}):l.CookieNotice.services[e]=t,"undefined"!==t&&(this.setCookie(this.cookieName,JSON.stringify(l.CookieNotice.services),this.settings.cookieDuration),void 0!==this.settings.onChangeState&&this.settings.onChangeState.call({cookieNotice:this,services:l.CookieNotice.services,service:e,state:t})),this},loadStates:function(){var e=this.getCookie(this.cookieName);return!!e&&(e=JSON.parse(e),l.each(e,function(e,s){l.CookieNotice.services[e]=s}),e)},getState:function(e){return void 0!==l.CookieNotice.services[e]?l.CookieNotice.services[e]:"undefined"},isAllowed:function(e){return!0===this.getState(e)},hasConsent:function(){return!!this.getCookie(this.cookieName)},reload:function(){this.settings.reload&&window.location.reload()},getCookie:function(e){return new RegExp("(?:; )?"+e+"=([^;]*);?").test(document.cookie)?decodeURIComponent(RegExp.$1):null},setCookie:function(e,s,t,i){var o=new Date,n=new Date;i=i||"/",n.setTime(o.getTime()+24*t*60*60*1e3),document.cookie=e+"="+s+";expires="+n.toGMTString()+";path="+i+";"},removeCookie:function(e,s){return this.setCookie(e,"",-1,s)},setLog:function(e,s){s=s||"log",console[s]("CookieNotice: "+e)},replacePrefixClass:function(){var t=this;return l.each(t.settings.classes,function(e,s){"string"==typeof s&&(t.settings.classes[e]=s.replace(/{prefix}/,t.settings.classes.prefix))}),t}},l.fn.cookieNotice=function(e){return new l.CookieNotice(l(this),e)}}(jQuery);
