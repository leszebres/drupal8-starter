!function(i){"use strict";i.ToggleMenuPush=function(e,t){return this.toggleMenu=e,i.extend(!0,this.settings={},this.toggleMenu.settings,i.ToggleMenuPush.defaults,t),this.elements=this.settings.elements,delete this.settings.elements,this.events={},this.isOpen=!1,!!this.prepareOptions()&&this.load()},i.ToggleMenuPush.defaults={elements:{content:{menu:void 0},items:void 0,itemLink:function(e){return e.children("a")},itemContent:function(e){return e.children("ul")},toggle:void 0,page:void 0,back:void 0,backBtn:function(e){return e.children("button")}},layout:"accordion",backLink:!1,classes:{open:"is-{prefix}Open",submenuOpen:"is-{prefix}SubmenuOpen",active:"is-active",copy:"{prefix}-copy",back:"item-back"},onLoad:void 0,beforeWrap:void 0,onAddContent:void 0,afterEventsHandler:void 0,afterItemHandler:void 0,onAddItemContent:void 0,onComplete:void 0,onToggle:void 0,onToggleSubmenu:void 0},i.ToggleMenuPush.prototype={prepareOptions:function(){return this.toggleMenu.replacePrefixClass.call(this),void 0===this.elements.toggle&&(this.elements.toggle=i("."+this.settings.classes.prefix+"-toggle"),0===this.elements.toggle.length)?(this.toggleMenu.setLog("error","Missing elements.toggle parameter"),!1):void 0===this.elements.content.menu?(this.toggleMenu.setLog("error","Missing element.content.menu parameter"),!1):void 0!==this.elements.page||(this.elements.page=this.toggleMenu.elements.body.children("div:first"),0!==this.elements.page.length)||(this.toggleMenu.setLog("error","Missing element.page parameter"),!1)},load:function(){return void 0!==this.settings.onLoad&&this.settings.onLoad.call({toggleMenuPush:this}),this.wrap(),this.addContent(),this.eventsHandler(),this.itemsHandler(),void 0!==this.settings.onComplete&&this.settings.onComplete.call({toggleMenuPush:this,elements:this.elements,wrapper:this.elements.wrapper}),this},wrap:function(){return this.elements.wrapper=i("<nav>",{class:"nav nav--"+this.settings.classes.prefix+"Push"}),void 0!==this.settings.beforeWrap&&this.settings.beforeWrap.call({toggleMenuPush:this,wrapper:this.elements.wrapper}),this.elements.wrapper.appendTo(this.toggleMenu.elements.body),this},unWrap:function(){return this.elements.wrapper.remove(),this},addContent:function(){var s=this;return i.each(s.elements.content,function(e,t){var n=null;"close"===e?n=i("<button>",{html:t}):"object"==typeof t&&t.length&&((n=t.clone()).removeAttr("id"),t.addClass(s.settings.classes.copy)),null!=n&&(n.appendTo(s.elements.wrapper),n.wrap(i("<div>",{class:s.settings.classes.prefix+"-"+e})),"close"!==e&&"menu"!==e||(s.elements[e+"Content"]=n,s.elements[e]=n.parent()),"menu"===e&&(void 0===s.elements.items?s.elements.items=s.toggleMenu.getItemsParent(n.find("li")):"function"==typeof s.elements.items&&(s.elements.items=s.elements.items(n)))),void 0!==s.settings.onAddContent&&s.settings.onAddContent.call({toggleMenuPush:s,type:e,element:t,content:n,contentWrapper:s.elements[e]})}),s},eventsHandler:function(){var e=this;return e.elements.toggle.on(e.events.toggle="click.togglemenu.toggle",function(){e.toggle()}),void 0!==e.elements.closeContent&&e.elements.closeContent.on(e.events.closeContent="click.togglemenu.close",function(){e.toggle()}),void 0!==e.settings.afterEventsHandler&&e.settings.afterEventsHandler.call({toggleMenuPush:e,elements:e.elements,events:e.events}),e},itemsHandler:function(){var n=this;return n.elements.items.length&&n.elements.items.each(function(e,t){(t=i(t)).layout=n.getItemLayout(t),t.addClass("l-"+t.layout),n.addItemContent(t),n.elements.itemLink(t).on("click.togglemenu.itemLink",function(e){e.preventDefault(),n.toggleSubmenu(t)}),void 0!==n.settings.afterItemHandler&&n.settings.afterItemHandler.call({toggleMenuPush:n,elements:n.elements,item:t})}),n},getItemLayout:function(e){if("data"===this.settings.layout&&void 0!==e){var t=e.attr("data-layout");return void 0!==t||""!==t?t:i.ToggleMenuPush.defaults.layout}return this.settings.layout},addItemContent:function(e){var t=this;if("panel"===e.layout){var n=null;if(void 0!==t.elements.back)n=t.elements.back;else{n=i("<li>",{class:t.settings.classes.back}),i("<button>",{class:"item-btn"}).appendTo(n);var s=i("<span>",{class:"item-title",html:t.elements.itemLink(e).text()}).appendTo(n);t.settings.backLink&&s.wrapInner(i("<a>",{href:t.elements.itemLink(e).attr("href")}))}null!==n&&(n.prependTo(t.elements.itemContent(e)),t.elements.backBtn(n).on("click.togglemenu.backBtn",function(){t.toggleSubmenu(e)}),void 0!==t.settings.onAddItemContent&&t.settings.onAddItemContent.call({toggleMenuPush:t,item:e,itemContent:n}))}return t},toggle:function(){var t=this;return t.toggleMenu.elements.body.toggleClass(t.settings.classes.open),t.isOpen=t.toggleMenu.elements.body.hasClass(t.settings.classes.open),setTimeout(function(){t.isOpen?t.elements.page.on(t.events.page="click touchstart",function(e){e.preventDefault(),t.isOpen&&t.toggle()}):(t.elements.page.off(t.events.page),t.closeSubmenus())},0),void 0!==t.settings.onToggle&&t.settings.onToggle.call({toggleMenuPush:t,body:t.toggleMenu.elements.body,page:t.elements.page,isOpen:t.isOpen}),t},toggleSubmenu:function(e){return this.closeSubmenus(e),e.toggleClass(this.settings.classes.active),void 0!==e.layout&&"panel"===e.layout&&(this.elements.wrapper.scrollTop(0),this.toggleMenu.elements.body.toggleClass(this.settings.classes.submenuOpen)),void 0!==this.settings.onToggleSubmenu&&this.settings.onToggleSubmenu.call({toggleMenuPush:this,item:e}),this},closeSubmenus:function(e){var t=void 0!==e?e.siblings("."+this.settings.classes.active):this.elements.items,n=t.find("."+this.settings.classes.active);if(t.length&&(t.removeClass(this.settings.classes.active),this.toggleMenu.elements.body.hasClass(this.settings.classes.submenuOpen)&&this.toggleMenu.elements.body.removeClass(this.settings.classes.submenuOpen)),n.length&&n.removeClass(this.settings.classes.active),void 0!==e){var s=e.find("."+this.settings.classes.active);s.length&&s.removeClass(this.settings.classes.active)}return this},unload:function(){var n=this;return n.isOpen&&n.toggle(),n.unWrap(),i.each(n.events,function(e,t){n.elements[e].off(t)}),n.elements.items.each(function(e,t){t=i(t),n.elements.itemLink(t).off("click.togglemenu.itemLink"),void 0!==n.elements.back&&n.elements.backBtn(t).off("click.togglemenu.backBtn")}),i.each(n.elements.content,function(e,t){"close"!==e&&t.removeClass(n.settings.classes.copy)}),n}}}(jQuery);